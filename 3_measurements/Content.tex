\part{Characterising the beam} % (fold)
\label{prt:characterising_the_beam}
\chapter{Introduction} % (fold)
\label{cha:introduction}
Characterisation of the MuSIC beam was carried out over several years and through a number of experiments. Over the course of five beam-times three significant measurements were made to characterise the beam: the total charged particle flux, the muon lifetime and the momentum spectrum; table~\ref{tab:summary_music_beam_time} covers the details. Several other experiments were also carried out although these are not discussed here.
\begin{table}[htpb]
  \begin{center}
  \begin{tabular}{c|c|c}
    \multicolumn{2}{c|}{Dates}          & Measurements                                \\
    Start            & Stop             &                                             \\
    \hline                                                                             
    29 July 2010     & 31 July 2010     & Charged particle flux.                      \\
    13 February 2011 & 16 February 2011 & Muon lifetime in Cu and Mg.                 \\
    19 July 2011     & 21 July 2011     & Muon yield (via lifetime).                  \\
                     &                  & Muon yield (via muonic X-rays).             \\
    22 October 2011  & 23 October 2011  & Neutron flux.                               \\
    18 June 2012     & 22 June 2012     & Muon momentum spectrum (via lifetime).      \\
                     &                  & Muon momentum spectrum (via muonic X-rays). \\
  \end{tabular}
  \end{center}
  \caption{A summary of the five MuSIC beam-times with notes on the measurements made.}
  \label{tab:summary_music_beam_time}
\end{table}

This part has been split into several chapters, this introduction will now focus on the technology used, each measurement will then have a chapter that discusses the aims, set up, results and analysis of that set of experiments.

\section{Experimental Technique} % (fold)
\label{sec:experimental_technique}
This part will begin with general discussion of the experimental techniques used before focusing on each of the measurements in turn. This will cover the preparation and use of scintillators, MPPCs and the common modules used to create the Data Acquisition system (DAQ).
\subsection{Scintillator preparation} % (fold)
\label{sub:scintillator_preparation}
As discussed in section~\ref{sec:introduction_scintillation} scintillating materials produce light when charged particles travel through them. There are several categories of scintillator, the ones used for our measurements were plastic as they are easy to work with, inexpensive and available in a range of sizes. There are two main considerations in preparing a plastic scintillator: maximising light collection and preventing external light contamination. The standard approach to deal with both of these considerations is to polish and wrap the scintillator.

The scintillator surface is highly vulnerable to damage either through scratches or grease. Damage to the surface of the scintillator is problematic as it inhibits light collection by reducing the amount of total internal reflection (TIR) from the inside of the scintillator. Anything that reduces the amount of TIR increases the amount of light absorbed outside of the scintillator, where it cannot be detected. In order to prevent the scratches scintillators must be handled carefully and protective films are only removed at the last moment. As well as careful handling the scintillators are cleaned to remove dirt and dust by polishing them with iso-propanol and tissues, this removes grease that can also degrade the surface.

Scintillators are generally wrapped with two thin layers: an inner reflective material and an outer blackout material. The inner layer is normally aluminium-mylar or foil, this is wrapped loosely in order to leave a small air gap that has been shown to increase the amount of TIR (and hence light collection)~\cite{air gap to increase light collection}. The outer layer is normally a black plastic wrap. This is carefully sealed with tape to prevent light leakage (another aid to this is obviously turning any lights off in the experimental area). An important consideration is to keep the layers as thin as possible in order to minimise energy deposition to this end overlaps are kept to a minimum.


% subsection scintillator_preparation (end)
\subsection{Multi-Photon Pixel Counters} % (fold)
\label{sub:multi_photon_pixel_counters}
Multi-Photon Pixel Counters (MPPCs) are highly sensitive devices able to detect wide number of incident photons from single to thousands of hits (see figure~\ref{MPPC PICTURE}). An MPPC is a small device (normally \( \mathcal{O}(1\times1) \)~mm) made from many Avalanche PhotoDiodes (APD) operated in `Geiger-mode'. Each individual APD acts as a single pixel within the MPPC they are connected together so that the total output of the device is the sum of all the pixels. As each pixel will fire individually due to any single photon, and given their size, the readout of an MPPC will directly give the number of incident photons (see figure~\ref{INSERT PICTURE OF MPPC OUTPUT}). The APDs make use of the photoelectric effect and large voltages to produce an `avalanche' of electrons when fired by an incident photon. Operating in `Geiger-mode', where the supplied voltage is above the breakdown voltage of the device, even a single photon will produce a detectable signal. A downside to operating in Geiger-mode is that the APD's output is constant regardless of the number of incident photons, the MPPC will produce a signal proportional to the number of fired pixels, not the number of photons, although this should not be a problem with the low number of photons predicted.
% TODO check how many photons we expect at each MPPC as a function of energy

An MPPC has several key attributes: Photon-Detection Efficiency (PDE), peak sensitivity, time resolution, operating voltage (\( V_o \)), gain (\( M \)) and dark current (\(  \)). The PDE and peak sensitivity describe the likelihood of detection (see figure~\ref{PDE vs wavelength plot}) and the wavelength that the MPPC is most sensitive to respectively (typically 440~nm). Time resolution for MPPCs is generally very good, normally 200--300~ps for FWHM at 1 the single photon level. The operating voltage is the potential required to make the MPPC work, due to variance in manufacture this is given individually for each MPPC and has to has to be set correctly for optimum performance, Hamamatsu's MPPCs have \( V_o = 70\pm10 \)~V. The gain of the MPPC indicates the strength of the signal response to a photon, typical values are between \( 10^5 \) and \( 10^6 \), this corresponds to signals of \( \mathcal{O}(1\text{--}10) \)~\(\mu\)V. The dark current is a measure of how noisy a particular MPPC is, it's based on the rate of signals that have a strength equivalent to 0.5~photo-electron (p.e.), typical values are in the range 100--500 kcps (\( \times10^3 \)~counts per second).

As can be seen whilst MPPCs have many useful features they do have several features that need careful treatment to make them useful: mainly amplification and noise reduction. These two problems are closely related and in fact, when treated properly one will often help with the other. Given the size of the signal from an MPPC it is obvious that amplification is required to make the signal useable, in fact, as will be discussed below, an unfiltered MPPC signal is too small for detection by most standard equipment. Amplification is done using linear amps which are applied as soon as possible to reduce noise due to cabling as well as attenuation. As well as amplification simple filters are applied to the bias voltage and signal to help reduce noise (see figure~\ref{CIRCUIT DIAGRAM}). Careful ground was also required to reduce noise, this was mainly carried out by ensuring shared ground between different modules.

In order to physically detect the light the MPPCs were attached to the scintillators, either directly or, as in the final experiment, via Wave Length Shifting (WLS) fibres. For direct attachment to the scintillator optical cement was used, after the scintillator and MPPCs were cleaned the glue was prepared and a jig (normally a block of foam with the MPPC mounted in it) used to hold the MPPC in place whilst it dried. For non-fixed connections, like to WLS-fibres where adaptors were employed, optical grease was used. Optical cement and grease have refractive indexes close (if not the same) to that of the scintillators, this minimises TIR along any boundaries they are applied to. Whilst a significant proportion of scintillator construction is dedicated to increasing TIR at the boundary to the MPPC it obviously should be minimised to maximise the amount of light hitting the MPPC (rather than being reflected back into the scintillator).

% subsection multi_photon_pixel_counters (end)
\subsection{Secondary Emission Chamber} % (fold)
\label{sub:secondary_emission_chamber}
As well as studying the resultant beam knowledge of the initial proton beam is very important for normalisation. This is done using a Secondary Emission Chamber (SEC). A SEC uses thin foils of gold placed within a strong electrical potential, when protons pass through the foils a small number of electrons are produced as part of ionisation, these can then be collected and counted. The SEC only measures a fraction of the beam and even then, only in-directly. In order to calibrate the SEC calibration runs are performed in which the entire proton beam is absorbed with a copper block downstream of the SEC. Measurement of the total current produced by the block can then be used to determine the fraction absorbed by the SEC, and hence the conversion factor. 

Measurement of the SEC was carried out using scalers that counted the cumulative charge passing through the SEC.

% subsection secondary_emission_chamber (end)

\subsection{NIM, CAMAC and VME} % (fold)
\label{sub:nim_and_camac}
Rather than develop custom data acquisition hardware modular crate systems were used. A crate system supplies power and mechanical fixings for a range of modules, these modules can then be connected together to produce a system. Three crate systems were used: Nuclear Instrument Module (NIM), Computer Automated Measurement And Control (CAMAC) and VMEbus (VME). NIM supplies power only whilst CAMAC and VME provide a `backplane' through which data can be transferred to a control card.

NIM modules were primarily used to provide signal processing and data acquisition logic. The CAMAC and VME crates were used for data readout. Ultimate control and storage was carried out using a PC which recorded the data for later analysis. The rest of this section will discuss the basic modules used in NIM, CAMAC and VME.
\subsubsection{Discriminators} % (fold)
\label{ssub:discriminators}
A discriminator works by producing a digital signal when an input, analogue, signal exceeds some preset threshold. Converting the analogue signal to digital makes it much easier to manipulate as many of the other modules will only work with a digital signal. The discriminators were powered by NIM modules and and had their thresholds set manually using an oscilloscope to observe the effect of the threshold. The thresholds had a standard minimum value of \(\sim\)25~mV, in order to meet this linear amplifiers were used to boost the MPPC signal enough to be detectable. 

% subsubsection discriminators (end)
\subsubsection{Gates and Flip-flops} % (fold)
\label{ssub:gates}
Gates are modules that, when triggered produce an altered signal compared to the input. As well as delaying and lengthening signals gates can also be used in `latch' (or flip-flop) mode. Gates only accept digital signals but can create delays of up to 1~s, and equally change the length by similar amounts. In latch mode the input signal starts the output whilst another input resets it. Latch mode is used to create busy signals by using the input to indicate when the DAQ is processing an event and a signal from the PC to reset it.

% subsubsection gates (end)
\subsubsection{Logic units} % (fold)
\label{ssub:logic_units}
Logic units provide boolean logic for processing digital signals. The limiting factor is the number of inputs that can be combined and the complexity of the combinations, normally signals are combined in blocks with each block being combined with one logical operation (OR or AND), an entire unit will also often have a veto that will stop any further operations until the veto clears.

% subsubsection logic_units (end)
\subsubsection{Scaler} % (fold)
\label{ssub:scaler}
One of the simplest forms of read out is a count of triggers, this is what a scaler does. The primary concern with a scaler is the input specification to trigger a count as well as the maximum speed at which the unit can count. Modules can either be used with NIM, CAMAC or VME. When the rate is high or the maximum count is low multiple scalers can be daisy-chained together to provide carry over. 
% subsubsection scaler (end)
\subsubsection{Analogue to Digital Converter} % (fold)
\label{ssub:analogue_to_digital_converter}
There are two primary attributes of an MPPC signal that were measured: its size and its separation from other signals. In order to measure the size of the MPPC signal an Analogue to Digital Converter (ADC) was used. ADCs work in a variety of ways depending on the exact type of measurement they are making, two common versions used at MuSIC were Peak Sensing ADC (PS-ADC) and Charge-integrating ADCs (QDC). Both types of ADC measure a component of the input analogue signal, the PS type measures the peak voltage whilst the CI measures the integrated charge, both make these measurements only when enabled by the ADC's `gate'. The ADC's gate is normally set to be slightly longer than the expected signal from an MPPC, i.e.\ \( \sim \)50~ns. 

Several factors define the ADC: the number of bits it is able to read out, the range of input signals that it can measure, its linearity, digitisation/read time (`dead time') and number of channels. The number of bits the ADC has, the range and its linearity work together to determine the accuracy of the ADC; the number of bits determines the maximum resolution between any two values, the range determines the the values that the ADC can measure whilst the linearity maps measured values to actual voltages. dead time measure how long is required to measure the analogue signal and how long it takes to then send the digitised values to the controlling PC i.e.\ for how long the module is inoperative, `dead'. The number of channels on an ADC is a measure of how many inputs it can measure simultaneously, normally one is ascribed to each MPPC so that the triggering signal can be recorded.

A key feature of using an ADC is the pedestal, obviously any analogue signal is going to have some noise that represents its zero level, in an ADC this manifests as a large peak in the lower bins of the ADC, removal of the pedestal is often done on the ADC itself and through DAQ but it does sometimes have to be removed from the data as well.

% subsubsection analogue_to_digital_converter (end)
\subsubsection{Time to Digital Converter} % (fold)
\label{ssub:time_to_digital_converter}
A Time to Digital Converter (TDC) measures the time difference between two (or more) signals. Similarly to the ADC the core parameters for a TDC are the number of bits, the TDC's range, it's linearity, its dead time and number of channels. A TDC normally takes a single `start' signal and will then measure the delay(s) been that first signal and any further signals on the other channels (`stops'). A useful variant on the TDC used in later experiments was the Multi-Hit TDC (MH-TDC). Rather than measure a single start/stop pair for each channel the MH-TDC uses a ring buffer to record every in coming event, when the `start' signal is received it signals that the current state of the buffer (and some trailing amount) should be recorded. Using this method events proceeding the start signal can be recorded as well as those afterwards.

% subsubsection time_to_digital_converter (end)
\subsubsection{Registers} % (fold)
\label{ssub:registers}
Control registers are fairly simple devices but very useful in general control, they act as a simple toggle that can either send or receive a signal to the controlling PC. The main use of registers is to form an interrupt; used this way once data has been taken the ready state of the system can be signalled to the PC and the PC can begin read-out. The interrupt is often delayed so that full digitisation can occur although has to be carefully gauged to prevent excessive dead time. The second common use is to reset the system once read-out has completed, this normally means reseting a latched gate that has been holding the system in veto.

% subsubsection registers (end)
% subsection nim_and_camac (end)
% section experimental_technique (end)
% chapter introduction (end)
\chapter{Charged Particle flux} % (fold)
\label{cha:charged_particle_flux}
% TODO Pictures of set ups
% TODO Diagrams of set ups
The first experiments carried out at MuSIC aimed to establish the barest understanding of the beam, the flux of charged particles. Whilst this experiment yielded useful data it was ultimately a prototype for the technology and a way to test and develop the techniques for later experiments.

Two measurements of the charged particle flux were made: one using a long strip scintillator that measured the flux at a range of heights and a second that used a smaller disk that measured the flux at a number of points across the face of the disc. These measurements were made during two different beam-times but will be treated similarly as they share a lot of common design.

These early experiments had DAQ designs that were ultimately superfluous as the data it yielded was not used; this design is included for completeness.
\section{Experimental Set Up} % (fold)
\label{sec:experimental_set_up}
The experimental design for both measurements was broadly the same: the scintillators both had four MPPCs attached, read out was performed using NIM logic for basic triggering whilst read-out was performed via CAMAC crates, data was recorded on a PC and analysed afterwards. The scintillators were both wrapped with aluminium foil and black wrap, MPPCs attached via optical cement, details are in table~\ref{tab:charged_particle_flux_scint_details}.
\begin{table}
    \begin{center}
    \begin{tabular}{c|c|c|c}
        Shape  &  Volume (mm\(^3\))            &  MPPCs  &  MPPC positions                    \\
        \hline
        Strip  &  \(380 \times30\times10\)     &  4      &  \( \pm 5 \)~mm on each ends.      \\
        Disk   &  \( 3.5^2\times\pi\times20\)  &  4      &  Radially, every 90\( ^{\circ} \). \\
        
    \end{tabular}
    \end{center}
    \caption{Details of the scintillators used for the two measurements of the charged particle flux.}
    \label{tab:charged_particle_flux_scint_details}
\end{table}

The aim of these early experiments was to make three measurements: the total trigger rate, the difference in arrival times of light at the MPPCs and the distribution of the number of firing pixels at each MPPC. The total trigger rate would be proportional to the flux of charged particles through the scintillator. It was hoped that the timing difference between MPPC firings would be related to the position of the interaction within the scintillator (this was, ultimately false). The distribution of the number of firing pixels was hoped to give some idea of the energy deposited, and possible the types of particles. Ultimately only one of these was achieved.

The DAQ to make the latter two measurements was simple:
\begin{enumerate}
    \item Amplify the MPPC signal to a detectable level (see section~\ref{sub:multi_photon_pixel_counters}).
    \item Use a discriminator to remove noise.
    \item Use an AND module to form a trigger and raise a veto based on the co-incidence of events from all MPPCs.
    \item Record the analogue MPPC signal using an ADC.
    \item Use the trigger to start the TDC.
    \item Delay three of the remaining signals by an amount to form the stops to the TDC.
    \item Remove the veto on the system once read out is complete.
\end{enumerate}
This can be seen as a schematic in figure~\ref{fig:MuSIC1_DAQ_Block}. 

\begin{figure}[hptb]
    \centering
        \includegraphics[width=.9\textwidth]{images/charged_flux/MuSIC1_DAQ_Block.png}
    \caption{Schematic of the DAQ used for measuring the charged particle flux. Horizontal blocks indicate NIM units whilst vertical ones were mounted in a CAMAC crate.}
    \label{fig:MuSIC1_DAQ_Block}
\end{figure}

To make the final measurement, the trigger rate, the majority of the DAQ was ignored and the four-fold co-incidence counted using a scaler. By counting the raw triggers affects of dead time could be negated and a truer value for the number of interactions obtained. For the 1D experiment measurements were made over 50~s with control done via hand, this obviously had limitations 

The positions of the two experiments are given in table~\ref{tab:charged_particle_positions} with respect to the centre of the beam-pipe.
\begin{table}
    \begin{center}
    \begin{tabular}{c|c|c|c|c|c}
        Measurement  &  \multicolumn{3}{c|}{Distance from centre of beam (cm)}         &  Scaler Time (s)  &  Readout \\
                     &    Horizontal    &       Vertical              &  Longitudinal  &                   &          \\
        \hline            
        1D           &  n/a             &  \(-5\), \(-15\), 0, 15, 5  &       6        &  50               & By-eye   \\
        2D           &  \(-17\), 0, 17  &  \(-16\), 0, 20, 25         &       85       &  20               & CAMAC    \\
    \end{tabular}
    \end{center}
    \caption{Positions at which the charged particle flux was measured, 1D refers to the first run in which only the vertical was measured, 2D refers to the second run in which horizontal measurements were also take. The distances from the beam-pipe were 6~cm for 1D measurements and 85~cm for 2D, this was due to mechanical constraints.}
    \label{tab:1d_res}
\end{table}

% section experimental_set_up (end) 
\section{Results} % (fold)
\label{sec:results}

The results from the measurements are presented in table~\ref{tab:1d_res}, for the 1D case, and table~\ref{tab:2d_res} in the 2D case. Errors on the rates are the square-root of the count and are propagated appropriately. The flux was calculated using:
\begin{align}
    j &= \frac{F(C - C_{off})}{I} \\
    I &= K(S - S_{off})
\end{align}
where \(j\) is the flux, \(F\) is a scaling factor, \(C\) is the trigger count with the beam on, \(C_{off}\) is the background trigger rate (i.e.\ with the beam off), \(S\) is the SEC count, \(S_{off}\) is the SEC count with the beam off and \(K\) is the SEC to current conversion factor. The scaling factor, \(F\), was  used in normalise runs with different conditions. For the 1D measurement there was a discrepancy between the first four and last 5 measurements due to damage to the MPPCs (one broke and another became detached from the scintillator). During the 2D measurements some of the runs were made with an upstream experiment in a different configuration; they changed stopping target from 5~mm of copper to 20~mm to magnesium for the last 3 runs.

\begin{table}
    \begin{center}
    \begin{tabular}{ c | r@{\( \pm \)}l | c | r@{\( \pm \)}l | c | c | r@{\( \pm \)}l } 
        Height  &  \multicolumn{3}{c|}{Trigger Rate (kHz)}  
                                                             &  \multicolumn{3}{c|}{SEC (Hz)}  
                                                                            &  Factor  &  \multicolumn{2}{c}{Flux} \\
        (cm)   & \multicolumn{2}{c|}{Beam on}  
                                 & Beam off
                                           &  \multicolumn{2}{c|}{Beam on}  
                                                             &  Beam off  &  &  \multicolumn{2}{c}{(kHz/A)} \\
        \hline
          0     &   43.0 & 6.1   &   \multirow{3}{*}{\( 0.60\pm0.14 \)}
                                           &    25.1 & 3.6   &   \multirow{3}{*}{\( 7.6 \pm 1.1 \)}
                                                                       &    \multirow{3}{*}{\( 1.00\pm0.00 \)}
                                                                                 &   72   & 19   \\
        \(-5\)  &   28.8 & 4.1   &         &    25.7 & 3.7   &         &         &   47   & 12   \\
        \(-15\) &   10.1 & 1.4   &         &    24.2 & 3.5   &         &         &   17.8 &  4.7 \\
        \hline
          5     &   33.3 & 4.7   &   \multirow{4}{*}{\(1.66 \pm 0.30\)}
                                           &    26.0 & 3.7   &   \multirow{4}{*}{\( 8.0\pm 1.2 \)}
                                                                          &    \multirow{4}{*}{\( 1.65\pm0.33 \)}
                                                                               &   89   & 29 \\
          5     &   28.4 & 4.0   &         &    22.8 & 3.3   &            &    &   92   & 31 \\
         15     &   21.6 & 3.1   &         &    26.7 & 3.8   &            &    &   56   & 18 \\
         15     &   23.7 & 3.4   &         &    27.4 & 3.9   &            &    &   59   & 19 \\
         \hline
          0     &   26.1 & 3.7   &   \( 0.68 \pm 0.15 \)   &    26.0 & 3.7   &   \( 8.1 \pm1.2 \)   &    \( 1.65\pm0.33 \)   &   71   & 23 \\
    \end{tabular}
    \end{center}
    \caption{Summary of the results from the measurement of the vertical charged particle flux. The rates were calculated with counts taken over 50~s, errors on the rates are the square root of the value. The `factor' column accounts for the fact that for the later measurements one MPPC was broken and another damaged, these measurements are then scaled by the ratio of two measurements at 0~cm. The error on the }
    \label{label}
\end{table}

 \begin{figure}[hptb]
    \centering
        \includegraphics[width=.9\textwidth]{images/charged_flux/hit_rate_rescaled.png}
    \caption{Results of the 1D measurements, the last 3 entries had damaged MPPCs as noted. These damaged points have had their values rescaled by the ratio of the two 0~cm values, one which had fully working MPPCs, the other was the last measurement.}
    \label{fig:images_hit_rate_rescaled}
 \end{figure}
 
 % TODO note re multiple computer measurements for trigger count
 \begin{table}
    \begin{center}
    \begin{tabular}{c|c|c|c|c|c|r@{\( \pm \)}l}
        % TODO Should these have errors? 
        X     &   Y    &  \multicolumn{2}{c|}{Trigger Rate (Hz)}  &  \multicolumn{2}{c|}{SEC (Hz)}  &  \multicolumn{2}{c}{Flux}     \\
        (mm)  &  (mm)  &  Beam On          &  Beam Off        &  Beam On    &  Beam Off    &  \multicolumn{2}{c}{(Hz/A)}   \\
        \hline % TODO Finish this!
          0  &    0    &   3438.1          &    5.3           &      51     &           9  & 54  &  4 \\
        -17  &   20    &   5897.4          &    5.3           &      51     &           9  & 93  &  7 \\
        -17  &  -16    &   1976.4          &    2.4           &      68     &           9  & 22  &  1 \\
        -17  &    0    &   4859.5          &    3.9           &      73     &           9  & 50  &  2 \\
         17  &    0    &   3158.0          &    4.5           &      76     &           9  & 31  &  1 \\
         17  &   20    &   5254.9          &    4.4           &      71     &           9  & 56  &  3 \\
         17  &  -16    &   1350.5          &    2.8           &      67     &           9  & 15  &  1 \\
          0  &  -16    &   2181.7          &    4.8           &      69     &           9  & 24  &  1 \\
          0  &   20    &   7126.8          &    3.6           &      64     &           9  & 86  &  5 \\
          0  &    0    &   3768.8          &    3.0           &      66     &           9  & 44  &  2 \\
          \hline
          0  &   25    &   2297.5          &    1.8           &      46     &           9  & 41  &  3 \\
        -17  &   25    &   3479.1          &    6.0           &      47     &           9  & 60  &  5 \\
          0  &   20    &   4004.4          &   11.9           &      60     &           9  & 52  &  3 \\
    \end{tabular}
    \end{center}
    \caption{Table of the results from the 2D measurement. Measurements were taken over 20~s using a CAMAC scaler.}
 \end{table}
 
 \begin{figure}[hptb]
     \centering
         \includegraphics[width=.9\textwidth]{images/charged_flux/2D_hit_rate_dist.png}
     \caption{2D plot of the charged particle flux across the front of the MuSIC beam pipe.}
     \label{fig:2D_flux}
 \end{figure}
 
% section results (end)
\section{Detector efficiency} % (fold)
\label{sec:detector_efficiency}
As well as making measurements of the charged particle flux another important measurement made, soon after, the second beam time was measurement of the detector efficiency for the circular detector. This was done using 3 large PhotoMultiplier Tubes (PMT) attached to large (\( 40\times40\times1 \)~cm) scintillator paddles. Measurement of the disk detector was calculated using the ratio of detections by the PMTs to detection by the MPPCs (one size considerations had been taken into account).

The test procedure for this measurement was to do long runs with the PMT paddles sandwiching the disk then compare the number of cosmic rays detected in the paddles compared to those detected by the disk. First all remaining MPPCs were tested (one had become irrevocably damaged during beam time) then pairs were tested. Testing consisted of counting the occurrence of three-fold coincidence on the PMTs and either two or three fold coincidence on the MPPCs. Data was taken for approximately one day for each configuration. The results of this measurement are shown in table~\ref{tab:music2_eff}.

\begin{table}
    \begin{center}
    \begin{tabular}{c | c | c | c | c | c}
        Configuration  &  Run Time (\(\times 10^3\)s)  &  MPPC count  &  PMT count  &  Efficiency  &  Adjusted Efficiency \\
        \hline
        123            &  86.0                         &   1651       &  1161165    &  0.00142     &  0.059  \\
        12             &  92.3                         &   6055       &  1229389    &  0.00493     &  0.205  \\
        13             &  87.1                         &   5653       &  1179116    &  0.00479     &  0.199  \\
        23             &  84.4                         &   3999       &  1129137    &  0.00354     &  0.147  \\
        
    \end{tabular}
    \end{center}
    \caption{Summary of the data taken for measuring the MPPC detector efficiency. Configuration refers to which of the three MPPCs were tested. The efficiency is the simple ratio of the MPPC count to the PMT count whilst the adjusted efficiency has been scaled by the ratio of the areas of the scintillators, i.e.\ by \( \frac{40\times40}{\pi3.5^2} \).}
    \label{tab:music2_eff}
\end{table}
% section detector_efficiency (end)
\section{Analysis} % (fold)
\label{sec:analysis}
As can be seen from the figures~\ref{fig:images_hit_rate_rescaled}~and~\ref{fig:2D_flux} the beam spot is positioned slightly up and to the left of the centre of the pipe. As figure~\ref{fig:sim_2d_charged_particle_flux} shows both measurements agree of on the general position of the beam spot. The measurements are not directly comparable due to the differences in both scintillator volume and position with respect to the end of the beam-pipe. Obviously the flux for the 2D measurement is generally lower due to smaller scintillator and larger distance from the beam-pipe.

The detector efficiency measurement for the 2D apparatus allows a more accurate calculation of the flux whilst also providing a bench-mark efficiency for future uses of the scintillator/MPPC configuration. 

The biggest problem, and one which was a cause of many problems, was the fragility of the MPPCs. Both the MPPC itself and the optical cement that bonded them to the scintillator were liable to break and this caused many problems that were could not be easily fixed. 

A signifiant issue with the 1D measurement is the lack of a confirmation measurement that allows verification of the scaling but even if the re-scaled points are ignored then they confirm that the beam spot is in the upper half of the pipe, a measurement later confirmed by the 2D measurement. 

\begin{figure}[hptb]
    \centering
        \includegraphics[width=.9\textwidth]{images/charged_flux/sim_2d_charged_particle_flux.png}
    \caption{G4BL simulation of the charged particle flux at the end of the MuSIC beampipe. Simulation represents \(10^9\) initial protons.}
    \label{fig:sim_2d_charged_particle_flux}
\end{figure}

% section analysis (end)
% chapter charged_particle_flux (end)
\chapter{Muon Lifetime} % (fold)
\label{cha:muon_lifetime}
Measurement of the muon lifetime is primarily used as a basic form of particle identification. Muons have a relatively long lifetime (\(2.197~\mu\)s) that acts as a useful method of identification. Measuring the muon lifetime is also a reasonably simple measurement that can be made with basic equipment. Two scintillators are placed on either side of a suitable stopping target along the muon's direction of travel. The muons loose energy as they traverse the stopping target and some number will stop, these can then be detected by the electrons produced in their decay. Plotting the differences in time between a detection at the upstream scintillator and the downstream scintillator will then produce the characteristic exponential decay curve that can be used to measure the muon lifetime. The curve produced is actually the sum of two separate decay curves: the decay of free muons and, as we have a beam containing negative muons as well, a component due to negative captured muon decay. The ratio of these two component can be used to estimate the ratio of muon types within the beam.

In total three measurements of the muon lifetime were taken: one con-currently with the 2D charged particle flux measurement, a high-statistics run and then measurements that form the basis of the muon momentum spectrum measurement. The first two of these measurements will be discussed here and the final will be discussed in the final chapter of this part.

\section{Experimental Set Up} % (fold)
\label{sec:experimental_set_up}
The basic experimental set up for muon lifetime measurement has already been discussed: two scintillators sandwiching a stopping target. Both measurements were made using the same scintillator and stopping target: two \( 380\times50\times3.5 \)~mm scintillators and a \( 370\times80\times6 \)~mm pure copper target. Two MPPCs were mounted on the ends of each scintillator to provide readout. 

The DAQ used was a simple extension of the previous versions. This time, rather than measuring the time differences between the different individual MPPCs the TDC was used to measure the time between a hit on the upstream scintillator and then a hit on the downstream. A `hit' was considered to be a co-incident signal on both MPPCs of that scintillator. As a measure to reduce spurious signals due to other charged particles, e.g.\ electrons, a veto window of 50~ns was used. The veto window was a period following the upstream hit in which no hits were allowed in the downstream scintillator. The veto-window aimed to reject particles that didn't decay between the scintillators, unfortunately this removes a portion of the signal but enough remains for a reasonable measurement to be made.

% section experimental_set_up (end)
\section{Results} % (fold)
\label{sec:results} 
Figures~\ref{fig:music2_mu_lifetime} and \ref{fig:music3_muon_lifetime} shows the TDC measurements that were made to record the muon lifetime. The TDC bin values are converted to ns using:
\begin{align}
    t = K*(T_0-T)
\end{align}
where \( t \) is the real time, in ns, \( K \) is the calibration constant (0.025, measured by manufacturer), \( T \) is the value recorded in the MH-TDC and \( T_0 \) is the time when the start signal for the TDC was sent as recorded by the MH-TDC on a dedicated channel.

The data is then fitted with either one or two exponential decay functions and a flat background. Whether a single or double exponential is used depends heavily on the amount of data that was taken. A single function is mainly used to fit the free decay of muons whereas a second exponential can be used to model the decay of captured negative muons inside the stopping target. Fitting the copper-decay exponential requires much greater data as a significant proportion of the events from this are ignored because of the veto-window. In the first 50~ns \(\sim\)26~\% of all copper decays will have already occurred in comparison to only \(\sim\)2\% of free muon decays. 

\begin{figure}[hptb]
    \centering
        \includegraphics[width=.9\textwidth]{images/lifetime/music2_mu_lifetime_good.png}
    \caption{Results of the first measurement of the muon lifetime. The data was binned in 166~ns bins to remove the affects of noise on the data, only entries with an ADC value of 1,100 (which excluded the pedestal) were used.}
    \label{fig:music2_mu_lifetime}
\end{figure}
\begin{figure}[hptb]
    \centering
        \includegraphics[width=.9\textwidth]{images/lifetime/music3_muon_lifetime.png}
    \caption{Results of the second measurement of them muon lifetime. The data was split between bins with a width of 480~ns and the data was fitted for values above 220~ns. The lifetime of muonic copper was fixed to \( 163.5\pm1.0 \)~ns.}
    \label{fig:music3_muon_lifetime}
\end{figure}

% section results (end)
\section{Analysis} % (fold)
\label{sec:analysis}
As can be seen in figures~\ref{fig:music2_mu_lifetime} and \ref{fig:music3_muon_lifetime} the exponential decays are good fits to the data with reasonable chi-squared values (\(192.6/114\) and \( 728.7/240 \) respectively). The muon lifetimes measured are in good agreement with the canonical value of \(2.1969811\pm0.0000022\)~\cite{PDG} although the MuSIC2 measurement. Both measurements are low (with the MuSIC2 measurement being significantly lower) but this should be due to affects of other materials in the detector, for example the plastic scintillator which has a captured muon lifetime of \(2026.3\pm1.5\)~ns~\cite{SUZUKI}. 

% section analysis (end)
% chapter muon_lifetime (end)
\chapter{Momentum Spectrum} % (fold)
\label{cha:momentum_spectrum}
\section{Experimental Set Up} % (fold)
\label{sec:experimental_set_up}
% section experimental_set_up (end)
\section{Results} % (fold)
\label{sec:results}

% section results (end)
\section{Analysis} % (fold)
\label{sec:analysis}

% section analysis (end)

% chapter momentum_spectrum (end)


% part characterising_the_beam (end)


















% \part{Characterising the beam} % (fold)
% \label{prt:characterising_the_beam}
% % TODO: Measurements:: Measurements: Characterising the beam: write me
% \chapter{Introduction} % (fold)
% \label{sec:measurements_introduction}
% 
% Characterisation of the MuSIC beam was carried out over several years and through a number of experiments. Over the course of five beam-times three significant measurements were made to characterise the beam: the total charged particle flux, the muon lifetime and the momentum spectrum; table~\ref{tab:summary_music_beam_time} covers the details. Several other experiments were also carried out although these are not discussed here.
% \begin{table}[htpb]
%   \begin{center}
%   \begin{tabular}{c|c|c}
%     \multicolumn{2}{c|}{Dates}          & Measurements                                \\
%     Start            & Stop             &                                             \\
%     \hline                                                                             
%     29 July 2010     & 31 July 2010     & Charged particle flux.                      \\
%     13 February 2011 & 16 February 2011 & Muon lifetime in Cu and Mg.                 \\
%     19 July 2011     & 21 July 2011     & Muon yield (via lifetime).                  \\
%                      &                  & Muon yield (via muonic X-rays).             \\
%     22 October 2011  & 23 October 2011  & Neutron flux.                               \\
%     18 June 2012     & 22 June 2012     & Muon momentum spectrum (via lifetime).      \\
%                      &                  & Muon momentum spectrum (via muonic X-rays). \\
%   \end{tabular}
%   \end{center}
%   \caption{A summary of the five MuSIC beam-times with notes on the measurements made.}
%   \label{tab:summary_music_beam_time}
% \end{table}
% 
% \section{Experimental method} % (fold)
% \label{sec:experimental_method}
% All of the measurements discussed here use scintillators to measure the beam. As discussed in section~\ref{sec:charged_particle_interactions_in_matter} scintillators respond to ionisation by emitting photons. The number and spectrum of emitted photons depends on the amount of energy deposited and the characteristics of the material. A commonly quoted value for plastic scintillator's light yield is 1 photon per 100~eV of deposited energy~\cite{PDG particle detectors review}. 
% 
% To increase the proportion of light captured the scintillators were wrapped in mylar and then black-wrap. The combination of these two additional layers meant that any light exiting the scintillator would be reflected back in whilst external light was kept out to prevent background. The thickness of both the mylar and black-wrap were minimised in order to prevent excess energy loss in these layers.
% 
% Due to the large magnetic field present at the end of the beam large PMTs were not a viable option, instead a type of silicon photomultiplier (SiPM) called a `Multi-Photon Pixel Counter' (MPPC) was employed. Each MPPC is composed of an array of Avalanche Photodiodes (APD), an array typically contains between 100 and 1,600 individual APDs. An APD operates by maintaining a small region of doped silicon close to its breakdown voltage (for an MPPC this is \( \sim -\)70~V) when a photon is incident on this region an electron/hole pair is created via the photo-electric effect. The bias voltage is large enough to accelerate the electron/hole pair causing ionisation of the silicon and further pairs to be created. This `avalanche' of pairs has a gain of order \( 10^5 \), large enough (\( \sim \)25~mV) that with proper amplification and noise removal it can be detected.
% 
% The largest disadvantage to using MPPCs is that, due to their sensitivity, they're a noisy sensor. They typically have a false positive (the `dark count') rate of \( \mathcal{O}(150)\times10^3 \)~counts/s (cps). The dark count can be easily removed by rejecting low photon count events, a minimum voltage threshold of \( \sim 0.5\)~photo-electrons (p.e.) is used to measure the dark-count and, given the poisson-nature of the noise, a threshold of 1.5~p.e. will remove the majority of dark counts (\(\gtrsim60\%\)). 
% 
% % TODO Good example of MPPC signal
% 
% In order to make the actual measurements first the signals from the MPPCs had to be processed and then digitised. The exact details of this varied from measurement to measurement (and are discussed in the relevant chapters) the general process was always the same: first the signal is amplified, then it is determined if the signal is to be measured (triggering) and finally the signal is read out. 
% 
% Amplification of the signals was done to change the signal to one which was above the threshold of the discriminator units. The discriminator units normally had a minimum threshold of 10~mV with a minimum \emph{viable} (i.e.\ stable) threshold of \( \sim \)50~mv; the signals from an MPPC are generally \( \mathcal{O}(10) \)~mV obviously too small for the discriminators, even before any attenuation. In order to make the MPPC signals detectable the signal was amplified twice: first in the experimental hall and again at the DAQ-station, downstairs. 
% 
% Once the MPPC signal has been amplified suitably it is converted to a digital signal using a discriminator. The advantage of converting the analogue MPPC signal to a digital one is that the digital signal is much easier to manipulate and process, unfortunately there is a loss of information which has to be accounted for. Digitisation is done using a discriminator which is a device that receives an analogue input and sends a digital output. The digital output is sent (`asserted') when the input exceeds some pre-set threshold. Assuming that the input exceeds the discriminator's threshold for long enough to be detected (normally \(\gtrsim8\)~ns) the output will be asserted for as long as the input is or the pre-set minimum output width; which ever is longer. 
% 
% Whilst the MPPCs are all similar they are not identical so to account for variance in gain and inaccuracies in the analogue amplification discriminator thresholds were normalised to the number of photo-electrons that any particular voltage corresponded to. Setting the threshold was done using an oscilloscope to visualise the impact of any particular threshold by using the discriminator's output as the oscilloscope's trigger whilst plotting the analogue signal trace, an example of this can be seen in figure~\ref{fig:set_dis_thrs_for_mppc}.
% 
% \begin{figure}[hptb]
%   \centering  
%     \includegraphics[width=.9\textwidth]{images/edit/scope_dis_ch_2.png}
%   \caption{An example oscilloscope trace being used to set the discriminator threshold. In this case the threshold is set to \( \sim \)1.5~p.e. (i.e.\ \( \sim- \)15~mV). The discriminator signal being used to trigger is shown in green whilst the input MPPC signal is brown. There are 200~mV/div for the discriminator signal whilst the MPPC signal has 5~mV/div; the time resolution is 20~ns/div.}
%   \label{fig:set_dis_thrs_for_mppc}
% \end{figure}
% 
% Careful setting of the discriminator threshold removes the majority of noise from the signal it doesn't remove all of it, to account for this a more stringent requirement is placed upon signals from the MPPC: co-incidence across MPPCs. Whilst it's entirely possible for a burst of noise to mimic a signal of several photo-electrons in one MPPC it is highly unlikely for this to occur in more than one MPPC. The standard second stage of the DAQ is to require that all the MPPCs on a scintillator register a suitably strong (e.g.\ at least \( >1.5\)~p.e.) signal. The co-incidence requirement is also combined with any additional logic for the system, e.g.\ busy signals from the readout computer or anti-co-incidence with other scintillators. 
% 
% % TODO Calculate 
% 
% Anti-co-incidence is used heavily in the muon lifetime measurements. All the muons produced at MuSIC are travelling at a reasonable fraction of the speed of light, this means that scintillators with a suitably small separation (\( \mathcal{O}(10)\)~mm) will detect such a muons almost simultaneously. By placing a high density `stopping target' between two such scintillators it is possible to detect which muons have likely stopped by looking for a hit in the upstream scintillator and no corresponding hit in the downstream scintillator. 
% 
% % TODO probably want to split this into separate subsections, one per measurement device e.g. scaler, (PH)ADC and (MH)TDC as well as information on the modules used and CAMAC/NIM in general
% 
% As well as discrimination of the MPPC signals there are three other useful measurements to be made: counting the number of signals from the discriminator, measurement of the size of the MPPC signals and measurement of the timing difference between up and downstream scintillators (if used). Whilst the discriminator is a measurement of the signal size it has a very low information content, by using an Analogue to Digital Converter (ADC) it is possible to get a much more precise measurement of the either the peak potential (so called `Peak Height' or PH-ADC) of the signal or the integrated charge. For MPPCs the peak value of the potential is the most useful number so it is this that we measure. When two scintillators are used by measuring the time differences between an anti-co-incident hit in the upstream scintillator (and only the up-stream scintillator) and then subsequent hits in the downstream scintillator (after a suitable anti-co-incidence or veto window) it's possible to reconstruct the lifetime of the upstream particle, for this to work a Multi-Hit Time to Digital Converter (MH-TDC) is used. A MH-TDC is required as some number of the downstream hits will be noise (often electrons) the noise appears as a flat background whilst the signal, electrons produced in the decay of the upstream muon, are correlated with the start time through an exponential. 
% 
% % TODO figure out what SEC stands for
% % TODO Add info on SEC proton current measurement
% % TODO How well do we know the energy of the initial proton beam, especially at low energies? 
% % TODO need info on why 380 MeV is pion production threshold
% As well as measuring the properties of the muon beam in order to make reasonable measurements we need to understand the properties of the initial proton beam. The key value is the proton beam's current which defines the number of protons at the PCS and hence its efficiency. The proton beam's current is estimated during operation using a Secondary Emission Chamber (SEC). The SEC contains a thin gold foil that is connected to an ammeter enabling direct measurement of a fraction of the beam during a run. The exact fraction absorbed by the gold foil is determined during a calibration run in which the entire beam's current is measured using a copper block to absorb it.
% 
% % section experimental_method (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% % chapter measurements_introduction (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \chapter{Charged Particle Flux} % (fold)
% \label{sec:charged_particle_flux}
% % TODO: Measurements:: Charged Particle Flux: write me
% % TODO: Measurements:: Charged Particle Flux: cover scint design
% % TODO: Measurements:: Charged Particle Flux: cover DAQ
% % TODO: Measurements:: Charged Particle Flux: cover what happened
% % TODO: Measurements:: Charged Particle Flux: Check dimensions & positions of 1D scint
% % TODO: Measurements:: Charged Particle Flux: Check dimensions & positions of 2D scint
% Two measurements of the charged particle flux were made: the first using a long strip of scintillator (380\(\times\)30\(\times\)10~mm) positioned across the face of the beam pipe at a variety of heights; the second measurement was made using a \(35\)~mm radius \( 20 \)~mm deep disk. 
% 
% Both measurements were made using a scaler to count the raw trigger rate, which was recorded with the beam both on and off. The raw trigger rate is defined as a signal from all MPPCs that passes discrimination. To normalise the trigger rate between runs the proton beam intensity was measured using SEC.
% 
% % TODO check distance from beampipe
% The vertical measurements were made \( 50 \)~mm from the end of the MTS at: \( -15 \), \( -5 \), \( 0 \), \( +5 \) and \( +15 \)~mm, measured from the centre of the beam-pipe. For each position both the SEC and trigger rate were measured with the beam on, and then to measure the bias measured off. Each value was measured for 50~s.
% 
% % To make the measurement to values were recorded: the total trigger rate (i.e.\ the number of charged particles) and the intensity (i.e.\ current) of the proton beam (for normalisation). A trigger was defined as an all-MPPC co-incidence above the discriminator threshold. Measurement of the pro
% \begin{figure}[hptb]
%   \centering
%     \includegraphics[width=.9\textwidth]{images/hit_rate_rescaled.png}
%   \caption{Charged particle flux at a variety of vertical positions, 50~cm from the end of the MTS, at MuSIC. The note below each point indicates when the data was taken, the three right-most points have been rescaled (using the ratio of the 0~mm values) to account for the broken MPPCs (as noted). Measurement was taken using a \( 380\times30\times8 \)~mm scintillator mounted on aluminium support struts.}
%   \label{fig:1D_hit_rate_rescaled}
% \end{figure}
% 
% \begin{figure}[hptb]
%   \centering
%     \includegraphics[width=.9\textwidth]{images/2D_hit_rate_dist.png}
%   \caption{The charged particle flux at 5~cm from the end of the beam-pipe, measured using a 7~cm diameter scintillator.}
%   \label{fig:2D_hit_rate_dist}
% \end{figure}
% 
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 
% % TODO experimental methods dicussion of ADC
% % TODO experimental methods dicussion of TDC
% % TODO experimental methods dicussion of Scaler
% % TODO experimental methods dicussion of SEC
% 
% Measurements of the charged particle flux were made during the first two beam times. The first was carried out using a \( 380\times30\times10\)~mm scintillator bar mounted at a variety of heights whilst the second was done using a \( 20\times35 \)~mm disk that could be moved on both the horizontal and vertical axises. During each measurement ADC and TDC data was taken but ultimately was not used in analysis. The core measurement were scaler readings of the total trigger rate and SEC measurements of the proton beam used to normalise the data.
% 
% The first measurements were taken at 6~cm from the beam-pipe with the second at 85~cm. The DAQ used was similar for each: two stages of amplification followed by the discriminator set to 1~p.e.\ the discriminator was fed to a co-incidence detector that created a gate for ADC readout. TDC readings were taken to measure the time difference in each MPPC triggering. A schematic of the set up can be seen in figure
% % TODO DAQ block diagram
% 
% To measure the particle flux the total trigger rate for each scintillator was measured for 50~s; at the same time the SEC was also measured. The beam would then be switched off to measure the same values for background results. The total charged particle flux was then calculated using 
% \begin{equation} \label{eq:particle_rate}
%   \text{Rate} = \frac{C_{\text{On}} - C_{\text{Off}}} {K(I_{\text{On}} - I_{\text{Off}})}
% \end{equation}
% Where \( C \) is the trigger count, \( K \) is the SEC to Ampere conversion factor and \( I \) is the proton current as determined by SEC. 
% 
% \section{Vertical charged particle flux} % (fold)
% \label{sec:vertical_charged_particle_flux}
% As has been noted the vertical charged particle flux was measured using a scintillator bar, read out was done using four S10362-11-050U Hamamatsu MPPC mounted on the bar's ends as shown in figure~\ref{fig:1D scint}. The scintillator was supported on two aluminum structs and held in place using cable ties. 
% 
% Severn measurements were made at five heights, 
% \begin{table}
%   \begin{center}
%   \begin{tabular}{ c | c | c | c | c | c | c} 
%       Height & \multicolumn{2}{c|}{Trigger Count}   & \multicolumn{2}{c|}{SEC}  &  Particle Flux & Adjusted Flux \\
%       (cm)   & Beam on            & Beam off        &  Beam on  &  Beam off   &  (Hz/A)          & (Hz/A) \\
%       \hline
%       0      &  2,151,736  &  \multirow {4}{*}{30}  &  1,255  &  \multirow {4}{*}{381}  &  2,461.91  & n/a  \\
%       -5     &  1,438,685  &                        &  1,286  &                         &  1,589.67  & n/a  \\
%       -15    &    446,302  &                        &  1,212  &                         &  537.03    & n/a  \\
%       -15    &    502,596  &                        &  1,208  &                         &  607.70    & n/a  \\
%       \hline
%       5      &  1,663,702  &  \multirow {4}{*}{83}  &  1,298  &  \multirow {4}{*}{398}  &  1,848.47  & 2,957.39  \\
%       5      &  1,420,836  &                        &  1,142  &                         &  1,909.61  & 1,783.28  \\
%       15     &  1,080,170  &                        &  1,336  &                         &  1,151.48  & 1,886.07  \\
%       15     &  1,185,051  &                        &  1,371  &                         &  1,217.85  & 2,264.10  \\
%       0      &  1,307,015  &  34                    &  1,298  &  404                    &  1,461.95  & 2,957.39  \\
%   \end{tabular}
%   \end{center}
%   \caption{Summary of the results from the measurement of the vertical charged particle flux. The measurements above the line were taken with all four MPPCs still functioning whilst those below only had three fully functioning MPPCs, to reflect the impact this had the flux is adjusted by the ratio of the two measurements made at 0~cm.}
%   \label{label}
% \end{table}
% 
% % TODO charged particle flux: Schematic of the 1D scintillator with MPPC mounting
% % section vertical_charged_particle_flux (end)
% % chapter charged_particle_flux (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \chapter{Muon Lifetime} % (fold)
% \label{sec:muon_lifetime}
% % TODO: Measurements:: Muon Lifetime: write me
% % TODO: Measurements:: Muon Lifetime: cover set up
% % TODO: Measurements:: Muon Lifetime: cover daq
% % TODO: Measurements:: Muon Lifetime: cover first data set vs second
% \begin{figure}[hptb]
%   \centering
%     \includegraphics[width=.9\textwidth]{images/muon_decay_feb.png}
%     % TODO Add PDG muon lifetime
%   \caption{First measurement of the muon lifetime at MuSIC. A single exponential is used for the fit and the lifetime measured is compatible with the global measurement (PDG MUON LIFETIME~\cite{pdg for muons}).  } 
%   \label{fig:3_measurements_images_muon_decay_feb}
% \end{figure}
% 
% \begin{figure}[hptb]
%   \centering
%     \includegraphics[width=.9\textwidth]{images/muon_decay.png}
%   \caption{Second measurement of muon lifetime at MuSIC, made 19\( ^{th} \)--21\( ^{st} \)~July~2011. With the improved statistics a double exponential was used allowing an estimation of the \( \mu^{-} \) component to be made. This estimation is made by looking for muons stopping in the copper target. The muon lifetime is low but this is to be expected as there is a hidden component due to negative muons interacting with the scintillator and air~\cite{Muon lifetime in scintillator}.}
%   \label{fig:3_measurements_images_muon_decay}
% \end{figure}
% 
% 
% % chapter muon_lifetime (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \chapter{Muon Momentum Spectrum} % (fold)
% \label{sec:muon_momentum_spectrum}
% % TODO: Measurements:: Muon Momentum Spectrum: write me
% % TODO: Measurements:: Muon Momentum Spectrum: daq & set up 
% % TODO: Measurements:: Muon Momentum Spectrum: noise
% % TODO: Measurements:: Muon Momentum Spectrum: sensitve to
% % TODO: Measurements:: Muon Momentum Spectrum: stopping targets
% 
% \section{Experimental Set Up} % (fold)
% \label{sec:experimental_set_up}
% To measure the momentum distribution of the muon beam two separate problems had to be solved: firstly how to count the muons produced and secondly how to determine their momentum. The first problem is addressed by looking for muon decays through timing data whilst the second is dealt with by using degraders and a thin stopping target to select specific momentums. 
% 
% \subsection{Detector} % (fold)
% \label{sub:detector}
% The detector consisted of an aluminium degrader who's thickness could be varied to select different momentum ranges, a thin (0.5~mm) upstream counter and a thicker (3.5~mm) downstream counter on either side of a 0.5~mm copper stopping target. A schematic of the detector can be seen in figure~\ref{fig:setup}. Based on simulation (section~\ref{sec:simulated_data}) we can predict the mean momentum of muons that decay for different degrader thicknesses, the momentum distributions for the muons that stop can be seen in figure~\ref{fig:stopped_muon_mom} whilst the initial muon momentum distribution is given in figure~\ref{fig:initial_muon_momentum}, the mean momentums are also tabulated in table~\ref{tab:stopped_muon_mom}.
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[scale=0.5]{images/Detector_setup.png}
%     \caption{Experimental set up of the detector for MuSIC~5 (not to scale)}
%     \label{fig:setup}
% \end{figure}  
% %
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/muon_momentum_at_beam_pipe_exit.png}
%     \caption{The initial muon momentum at the exit of the beampipe as simulated by G4Beamline~\cite{G4BL} (G4BL). The muon rate has been normalised to \( 1\mu \)A of proton current which is the maximum available at the RCNP. Section~\ref{sub:g4bl_particle_production} for further details of the G4BL simulation.}
%     \label{fig:initial_muon_momentum}
% \end{figure}
% %
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/stopped_muon_momentum.png}
%     \caption{Simulated momentum distributions for muons that decay between the up and downstream counters. 900~M initial protons were simulated with a range of aluminium degrader thicknesses. Stopped muons were those seen in the upstream counter that subsequently had a daughter electron seen in the downstream counter. This plot shows raw counts for the 900~M initial protons.}
%     \label{fig:stopped_muon_mom}
% \end{figure}
% %
% \begin{table}
%     \begin{center}
%     \begin{tabular}{r|r@{ $\pm$ }l|r@{ $\pm$ }l} % r@{ $\pm$ }l should align on \pm
%         Degrader (mm) & \multicolumn{2}{|c|}{Mean (MeV/c)} & \multicolumn{2}{|c}{RMS (MeV/c)}\\
%         \hline
%         Air 5.0       & 41.03 & 0.21 & 21.59 & 0.15 \\
%         Aluminium 0.5 & 46.68 & 0.20 & 19.84 & 0.14 \\
%         Aluminium 1.0 & 50.29 & 0.21 & 19.13 & 0.15 \\
%         Aluminium 5.0 & 65.66 & 0.22 & 16.86 & 0.16 \\
%     \end{tabular}
%     \end{center}
%     \caption{Simulated mean momentums for decaying muons. 900~M initial protons}
%     \label{tab:stopped_muon_mom}
% \end{table}
% %
% The counters used were mylar wrapped scintillators with read-out performed by MPPCs mounted on either end of a wave length shifting fibre bounded along the long axis of the scintillator using optical cement. The signals from each pair of MPPCs are combined and amplified before being passed to the data acquisition system (DAQ) for processing.
% 
% % subsection detector (end)
% \subsection{Data Acquisition} % (fold)
% \label{sub:data_acquisition}
% The Data Acquisition (DAQ) took two measurements: the time at which signals arrived from the MPPC and the strength of those signals. The timing measurements are of the primary concern for this analysis. The DAQ itself had 3 distinct stages: discrimination, trigger formation and readout.
% 
% MPPCs are inherently noisy devices and discrimination is required to separate signal due to scintillation events from the MPPC's noise. A voltage threshold was set which (when exceeded) created a digital signal. Two thresholds were used: a lower one for the upstream counter and a higher one for the downstream counter. The lower threshold for the, thinner, upstream counters enabled better detection of minimally ionising muons whilst the higher downstream threshold enabled better detection of the more ionising electrons produced by muon decay. 
% 
% Using the signals from the discriminator a trigger was created based on the signature of muonic decay: the anti-coincidence of the up and downstream counters. It was assumed that a muon that doesn't decay in the detector region will be seen in both counters within a very small window of time ($<$50~ns). The only other constraint on the formation of a trigger was that the system wasn't busy in which case the trigger couldn't be accepted.
% 
% The trigger, once formed, signalled the start of readout. There were 3 modules to be read out via VMEbus (VME): a charge to Digital Converter (QDC), a scaler and a Multi-hit Time to Digital Converter (MTDC) which is of primary concern for this analysis. The MTDC recorded all signals  within a 20\mus{} period following the trigger that passed discrimination and that were anti-coincident with the other counter. Using a MTDC ensured that even if some beam remnant or dark event created a signal then the real signal would also be recorded and determined with background removal. The channel assignment used for the MTDC can be seen in table~\ref{tab:mtdc_ch}. To increase the accuracy of the MTDC the trigger time is recorded on a seperate channel called `TDC0'.
% \begin{table}
%     \begin{center}
%     \begin{tabular}{c|c|c}
%         Channel & Signal & Notes\\
%         \hline
%         0  & TDC0 & Time at which the trigger was formed \\
%         \hline
%         1  & U1   & \multirow{8}{*}{Upstream Counter}\\
%         2  & U2   & \\
%         3  & U3   & \\
%         4  & U4   & \\
%         5  & U5   & \\
%         6  & U6   & \\
%         7  & U7   & \\
%         8  & U8   & \\
%         \hline
%         9  & D1   & \multirow{5}{*}{Downstream counter}\\
%         10 & D2   & \\
%         11 & D3   & \\
%         12 & D4   & \\
%         13 & D5   & \\
%         \hline
%         14 & Ge1  & \multirow{2}{*}{Germanium counter (not used in this analysis)}\\
%         15 & Ge2  & \\
%     \end{tabular}
%     \end{center}
%     \caption{Channel assignment for the MTDC. QDC channel assignment follows the same scheme but has no entry for channel 0 (as TDC 0 will be one of the upstream counters by design).}
%     \label{tab:mtdc_ch}
% \end{table}
% 
% The scaler was used to record system diagnostics (e.g. the trigger rate) by polling the scaler regularly during each run. The QDC recorded the strength of the trigging signal by integrating its charge over 100~ns. This information has not be incorporated into the current analysis but may be used in later analysis, for example to apply more stringent energy cuts at trigger time or for selection of regions of interest. The QDC had the same channel assignment as the TDC but without the germanium detector (as it had its own analogue to digital converter) and TDC0 (which was a digital signal).
% \begin{table}
%     \centering
%     \begin{tabular}{c|c|l}
%         Channel & Signal & Notes\\
%         \hline
%         0 & SEC & Measure of the proton current\\
%         1 & Trigger & number of t0's\\
%         2 & U and $\overline{\text{D}}$ & count of potential triggers\\
%         3 & U & Upstream only\\
%         4 & D & Downstream only\\
%         5 & Scint & -\\
%         6 & unused & -\\
%         7 & clk & Record of time passed\\
%     \end{tabular}
%     \caption{Table of scaler channels and their designation}
%     \label{tab:scaler_chs}
% \end{table}
% \section{Run Data} % (fold)
% \label{sec:run_data}
% As figure~\ref{fig:analysis_flow_diagrm} shows there are 5 stages in preparing the experimental data for analysis (receipt of the data from MIDAS, de-serialisation, calibration, restructuring and histogramming). These will will be explained in more detail in the following sub-sections but the general process will be discussed here. The first stage is the receipt of data from the DAQ via MIDAS, this creates files of raw data which has to be de-serialised in the next stage before having calibration applied to it. The final stages are to restructure the data according to channel and then create histograms of the TDC values ready for analysis. 
% 
% These processes are split across 4 programs: MIDAS; mu\_analysis and mid2root\_converter (which act on .root and .mid MIDAS files respectively); and finally tdc\_file.py which is a python script for creating the TDC histograms.
% 
% For the analysis 6 runs were chosen, all using the 0.5~mm copper stopping target. For 5 of the runs an aluminium degrader was used. The run information is summarised in table~\ref{tab:run_summary}.
% \begin{table}
%   \begin{center}
%   \begin{tabular}{c|c|c|c}
%       Run ID & Time (sec) & Current (nA) & Degrader (mm) \\
%       \hline
%       448    & 9,221      & 1.534E-02    & 0.0   \\
%       451    & 1,001      & 1.546E-02    & 0.5   \\
%       452    & 4,924      & 1.313E-02    & 0.5   \\
%       455    & 6,307      & 1.332E-02    & 1.0   \\
%       458    & 5,144      & 1.363E-02    & 5.0   \\
%       459    & 2,452      & 1.238E-02    & 5.0   \\
%   \end{tabular}
%   \end{center}
%   \caption{Summary of the runs selected for this analysis. The degrader used aluminium and the stopping target 0.5~mm copper.}
%   \label{tab:run_summary}
% \end{table} 
% \subsection{Data from MIDAS} % (fold)
% \label{sub:data_from_midas}
% MIDAS is `a general purpose data acquisition system for small and medium scale experiments'~\cite{ritt2012midas} and is the primary interface to the DAQ via VME. 
% 
% MIDAS stored the raw data from each run as a single file either in its own binary xml format (.mid files) or in ROOT~\cite{Brun199781} format (.root). Data was read from the VME crate in two asynchronous modes: `Trigger' and `Scaler' each corresponded to a separate tree structure in the resulting file. The majority of the time the system operated in trigger-mode: whenever a trigger was formed the controlling PC was informed and once the data had been gathered readout of the MTDC and QDC occurred via the VME. Scaler mode occurred at regular intervals and consisted of reading the diagnostics data gathered by the scaler, this did not reset the module which continued to accumulate data. 
% 
% Each tree contained a branch per module being read, the trigger tree also had also branch for errors (named `ERR'). The branches all had the same structure: an integer that recorded the number of values read and an array of integers containing those values. For the scaler and QDC modules the number of values read out was the same for every trigger as both had a fixed number of channels and took one measurement on each. The MTDC had a variable number of values to read out as it could record multiple hits on each channel.
% % subsubsection data_from_midas (end)
% \subsection{De-Serialisation} % (fold)
% \label{sub:de_serialisation}
% The first raw data from MIDAS for the MTDC and QDC were serialised and mangled with the channel number this means that they require processing before the real values can be extracted. Below are brief summaries of the algorithms used to de-serialise the MTDC data (listing~\ref{lst:mtdc_algo}), for full listings, including de-serialisation methods for QDC, see appendix~\ref{app:deserialisation}.
% %
% \begin{listing}[htbp]
%     \begin{minted}[gobble=4]{c++}
%     tdc_value      =  raw_val & 0x001f ffff
%     tdc_channel    = (raw_val & 0x03e0 0000) >> 21
%     tdc_valid_read = (raw_val & 0xf800 0000) == 0x0
%     \end{minted}
%     \caption{Method for de-serialising CAEN V1290N~\cite{CAENV1290N} data}
%     \label{lst:mtdc_algo}
% \end{listing}
% % subsection de_serialisation (end)
% \subsection{Calibration} % (fold)
% \label{sub:calibration}
% The MTDC has a stated least significant bit resolution of $\sim$25~ps with a 21 bits of data per value, this gives a maximum value of 52\mus{}. Conversion from the stored value to real, trigger aligned, time is done using the formula:
% \begin{align}\label{equ:tdc_calibration}
%     t'   &= 0.024414(t - \text{TDC}0)
% \end{align}
% where $t'$ is the calibrated time, $t$ is the de-serialised MTDC value and TDC$0$ is the de-serialised trigger time. The value $0.024414$ is the calibration co-efficient as determined in Tran Nam's work~\cite{timecalibNam2012}
% % subsection calibration (end)
% \subsection{Restructure} % (fold)
% \label{sub:restructure}
% In order for the MIDAS data to be easily manipulated it was restructured. The initial format was a simple structure of one branch for each module (i.e. one for MTDC one for the QDC and a final one for errors). A second tree was used to store the scaler values. Each branch had a leaf for the number of values and a leaf with the array of values.
% 
% In the restructured file each channel is a branch of a tree with the following leaves: QDC, TDC0, nHITS, TDC[nHITS]. The QDC value is self-explanatory, TDC0 was the trigger time, nHITS was the number of entries recorded by the MTDC for that channel and TDC was an array of the values. The error data was ignored as was the scaler tree as these can be read from the original file if needed and neither was required for de-serialisation or calibration.
% % subsection restructure (end)
% \subsection{Histogramming} % (fold)
% \label{sub:Histogramming}
% Once the data has been restructured it is trivial to create a histogram of the TDC data for each channel which forms the basis of the later analysis. A basic bin width of 1~ns was used and a range from 0 to 20\mus. A time of 0 was used for the lowest bin as, although the data window began at 50~ns, the MTDC recorded data as a sliding window so some values prior to the trigger were also recorded. All the histograms for (i.e. for all channels for all runs) were saved in the same root file.
% % subsection histogramming (end)
% % section run_data (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Secondary calculations} % (fold)
% \label{sec:secondary_calculations}
% There are two secondary calculations that need to be performed to calculate the muon yield. These are the acceptance, the fraction of the total beam we can expect to detect, and the dead time, a measure of how much of the time the detector is unable to process new data due to being busy.
% \subsection{Acceptance} % (fold)
% \label{sub:acceptance}
% To calculate the acceptance the ratio of initial muons to muons that passed a `trigger' cut was calculated. This is done by counting the number of muons in simulated G4BL output (section~\ref{sub:g4bl_particle_production}) and then using a macro similar to that used to digitise the simulation output (section~\ref{sub:digitisation_histogramming}) to mimic the triggering process.
% 
% The main difference between the acceptance macro (appendix~\ref{appsub:acceptance}) and the digitisation macro (appendix~\ref{appsub:digitisation_macro}) were in the cuts applied to select the particles. Rather than any possible parent particle in the upstream detector only muons are selected, similarly, in the downstream detector only electrons who had a parent muon are selected. A final requirement is that the time difference between muon and electron is greater than 50~ns.
% 
% The acceptance is then the ratio of muon/electron pairs to the initial number of muons:
% \begin{align}
%     \text{Acceptance} &= \frac{\text{Decay muons}}{\text{Initial Muons}} \label{equ:acceptance}
% \end{align}
% It is worth noting that given the above definition and method the acceptance changes due to the thickness and type of degrader used. Obviously a degrader that removed the majority of the muons from the beam will have a smaller acceptance as a smaller fraction of the beam will have survived to be detected. The results of the acceptance calculations are given in table~\ref{tab:acceptance}, the macro used can be seen in appendix~\ref{appsub:acceptance}.
% \begin{table}
%     \begin{center}
%     \begin{tabular}{c| r@{ $\pm$ }l | r@{ $\pm$ }l | r@{ $\pm$ }l | r@{ $\pm$ }l }
%         Degrader (mm) & \multicolumn{2}{|c}{Count (no cut)} &
%                         \multicolumn{2}{|c}{Count ($\Delta t>50$~ns)} &
%                         \multicolumn{2}{|c}{Initial Muons} &
%                         \multicolumn{2}{|c}{Acceptance (\%)}\\
%         \hline
%               Air 5.0 & 6330 & 80 & 4540 & 67.4 & 95719 & 309.4 & 4.7 & 0.1\\
%         Aluminium 0.5 & 5636 & 75 & 3999 & 63.2 & 95719 & 309.4 & 4.2 & 0.1\\
%         Aluminium 1.0 & 5222 & 72 & 3689 & 60.7 & 95719 & 309.4 & 3.9 & 0.1\\
%         Aluminium 5.0 & 3632 & 60 & 2472 & 49.7 & 95719 & 309.4 & 2.6 & 0.1\\
%         
%     \end{tabular}
%     \end{center}
%     \caption{The variance of acceptance with degrader thickness. In the final acceptance a cut on $\Delta t$ requiring it to be $>$50~ns was used to account for the anti-coincidence of the downstream counter. The number of initial muons is from the G4Beamline simulation.}
%     \label{tab:acceptance}
% \end{table}
% % subsection acceptance (end)
% \subsection{Dead time} % (fold)
% \label{sub:dead_time}
% The calculation of the dead time is unlike that of the acceptance as it was calculated based on the real data rather than simulation. Using the scaler it is possible to estimate how much of the time the DAQ was busy and hence what percentage of data was missed. 
% 
% As was stated in section~\ref{sub:data_acquisition} the scaler was used to record diagnostics on the DAQ. To calculate the dead time only two are needed, the trigger count and the potential trigger count which can be used to calculate the dead time thus:
% \begin{align}
%     D = \frac{\text{Potential Triggers}}{\text{Good Triggers}}
% \end{align}
% Where potential triggers are considered any anti-coincidence of the up without the downstream counter and a good trigger is one in which this occurs without the system being busy. The results for are given in table~\ref{tab:dead_time}. Obviously, the dead time is not used in the yield calculations using the simulated data.
% \begin{table}
%     \begin{center}
%     \begin{tabular}{c|c|c|r@{ $\pm$ }l|r@{ $\pm$ }l|r@{ $\pm$ }l }
%         Run & Degrader (mm of Al) & Run time (s) &
%                               \multicolumn{2}{|c}{Good Triggers} &      
%                               \multicolumn{2}{|c}{Potential Triggers} &
%                               \multicolumn{2}{|c}{Dead time (\%)} \\
%         \hline
%         448 & 0.0 & 9221 & 9652965 & 3106 & 15678757 & 3959 & 61.57 & 0.03 \\
%         451 & 0.5 & 1001 &  767321 & 875  &  1070366 & 1034 & 71.69 & 0.11 \\
%         452 & 0.5 & 4944 & 3459886 & 1860 &  4667767 & 2160 & 74.12 & 0.05 \\
%         455 & 1.0 & 6307 & 4090246 & 2022 &  5372409 & 2317 & 76.13 & 0.05 \\
%         458 & 5.0 & 5144 & 2049077 & 1431 &  2454952 & 1566 & 83.47 & 0.08 \\
%         459 & 5.0 & 2452 &  915314 & 956  &  1077534 & 1038 & 84.95 & 0.12 \\
%     \end{tabular}
%     \end{center}
%     \caption{Dead time for each run along with the number of potential and good triggers. Run time is included to show the origin of the different counts.}
%     \label{tab:dead_time}
% \end{table}
% % subsection dead_time (end)
% \subsection{Gain stability} % (fold)
% \label{sub:gain_stability}
% In order to better understand possible sources of systematics in the experiment the total trigger rate for each run was plotted over time. The gain stability should then be proportional to this trigger rate, giving a measure of how well the detector was working and highlighting any possible problems in the run. To plot this value the events produced in a run were divided into 10 sections, each containing an equal number of events. Using the values recorded by the scaler the length of each section in seconds could be determined (channel 7, see table~\ref{tab:scaler_chs}) as could the number of triggers seen in that section (channel 1). The results are plotted in figure~\ref{fig:gain_stability}, note that as the degrader thickness is increased the fit value decreases which is consistent with fewer particles reaching the detector. Full listings for plotting the gain stability can be found in appendix~\ref{appsub:gain_stability}.
% %
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/gain_stability.png}
%     \caption{Gain stability for each run, the black lines indicate the gain stability for that period of time (each $\sim^1/_{10}^{\text{th}}$s of the run) whilst the blue histogram plots the cumulative number of triggers. The gain stability has bit fitted with an order 0 polynomial who's parameters are given.}
%     \label{fig:gain_stability}
% \end{figure}
% %
% \begin{table}
%     \begin{center}
%         \begin{threeparttable}
%             \begin{tabular}{c|c|c|c|r@{ $\pm$ }l}
%                 Run & Al degrader thickness (mm) & $\chi^2$ 
%                                                  & N.D.F. \tnote{a}
%                                                  & \multicolumn{2}{|c}{Gain} \\
%                 \hline
%                 448  &  0.0  &  52.94   &  9  &  1.682  &  0.015  \\
%                 451  &  0.5  &  0.8361  &  9  &  1.065  &  0.029  \\
%                 452  &  0.5  &  14.7    &  9  &  0.940  &  0.011  \\
%                 455  &  1.0  &  83.68   &  9  &  0.8331 &  0.0089 \\
%                 458  &  5.0  &  83.41   &  9  &  0.4634 &  0.0055 \\
%                 459  &  5.0  &  1.964   &  9  &  0.4363 &  0.0075 \\
%             \end{tabular}
%             \caption{Gains as determined by the fits to the gain stability in figure~\ref{fig:gain_stability}.}
%             \begin{tablenotes}
%                 \item [a] Number of Degrees of Freedom
%             \end{tablenotes}
%             \label{tab:gain_stability_paramters}
%         \end{threeparttable}
%     \end{center}
% \end{table}
% 
% % subsection gain_stability (end)
% % section secondary_calculations (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Fitting And Integration} % (fold)
% \label{sec:fitting_and_integration}
% This section won't follow the figure~\ref{fig:analysis_flow_diagrm} stages too closely as they are heavily entwined, instead the algorithm will be broken into two sections: the theory (section~\ref{sub:the_theory}) and the implementation (section~\ref{sub:the_implementation}).
% 
% \subsection{The theory} % (fold)
% \label{sub:the_theory}
% Once both the real and simulated data has been processed and put into histograms they can be treated identically. In order measure the number of decays the histograms are fitted with the function 
% \begin{align}
%     P(signal) &= N_{b} + N_{f}e^{-t / \tau_{f}} + N_{c} e^{-t / \tau_{c}} \label{equ:fit}
% \end{align}
% Where $N_{b}$ is a flat modelling of the background; $N_{f}$ and $\tau_{f}$ are the contribution of the free muon part and the free muon lifetime respectively; and $N_{c}$ and $\tau_{c}$ are the muonic-copper contribution and lifetime. Once the histogram has been fitted with equation~\ref{equ:fit} integrating either exponential portion of it and dividing by the bin width gives the number of muon decays corresponding to that mode. Similarly the total number of muons is given by the sum of the two integrals:
% \begin{align}
%     N_{\mu} &= \frac{1}{B} \int_{l}^{u}\left(N_{f}e^{-t / \tau_{f}} + N_{c} e^{-t / \tau_{c}} \right) \label{equ:sum_exp_parts}
% \end{align}
% where $N_{\mu}$ is the total number of muon decays in the histogram and $l$ and $u$ are the lower and upper bounds of the fit respectively. 
% 
% Obviously this is not a perfect analysis, as can be see from the histograms for simulation and data (figure~\ref{fig:example_fits_data_and_sim}) there are large differences between the backgrounds. As discussed above the majority of the background can be modelled as a flat distribution and hence subtracted there are, though, physics backgrounds that can mimic the expected signal of a muon decaying. The primary source of this will likely be pions luckily these backgrounds are very small as its lifetime is much shorter (26~ns compared to 2.2\mus{} for the muon) these short lifetimes will unlikely trigger due to the anti-coincidence.
% 
% % subsection the_theory (end)
% \subsection{The implementation} % (fold)
% \label{sub:the_implementation}
% The implementation of the above algorithm is done using pyROOT~\cite{lavrijsenpyroot} which is a python wrapper for ROOT~\cite{Brun199781}. Python is a preferable language to C++ for complex analysis as it is generally less verbose (allowing more rapid development and fewer bugs) as well as incorporating more powerful data structures (such as dictionaries) into the core language. Being a loosely typed language python can handle mixed-type objects which means that all the data for run can be kept in a single structure. For concrete listings of each stage from figure~\ref{fig:analysis_flow_diagrm} see appendix~\ref{app:fitting_and_integration}.
% 
% There are 8 parameters that need to be set before the fit can proceed these are shown in table~\ref{tab:typical_fit_values} along with their typical initial values. There are two broad groups of parameter: `fit settings' which relate to the bounds on the fitting method and the `initial parameter values' which determine what values the fit uses as start points for its approximations. The fit settings primarily affect how good a fit is achieved whilst the initial parameter values are mainly chosen to ensure that there are no degeneracies in the fit. 
% 
% \begin{table}
%     \begin{center}
%       \begin{threeparttable}
%           \begin{tabular}{c | c | c }
%               Type & Parameter   & Value \\
%               \hline
%               \multirow{3}{*}{Fit Settings} & Bin width   & 75~ns \\
%                                             & Lower bound & 50~ns \\
%                                             & Upper bound & 20\mus \\
%               \hline
%               \multirow{3}{*}{Initial fit parameters} 
%                           & $N_{b}$     & $^1/_{10} \times$ maximum bin value \\
%                           & $N_{c}$     & Maximum bin value\\
%                           & $N_{f}$     & $^1/_{2} \times$ maximum bin value\\
%                           & $\tau_{c}$  & 163.5~ns $\pm$ 1~ns\\
%                           & $\tau_{f}$  & $\sim$2\mus\tnote{a}\\
%           \end{tabular}
%           \caption{Typical values for the fit parameters. \textbf{NB} that the copper value is often constrained as it is well know, the free muon lifetime is not well known as it is dependant on the combination of the muon lifetime in air, scintillator and as a free particle.}
%           \begin{tablenotes}
%               \item [a] The canonical free muon lifetime is 2.1969811$\pm$0.0000022\mus~\cite{Beringer2012}, see text for why this value is not fixed.
%           \end{tablenotes}
%           \label{tab:typical_fit_values}
%       \end{threeparttable}
%     \end{center}
% \end{table}
% %
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/example_fits_data_and_sim.png}
%     \caption{Example of typical histograms for both simulation and data. Each has been fitted with equation~\ref{equ:fit} using initial fit settings matching those in table~\ref{tab:typical_fit_values}. The run used was 448, channel D1, i.e. no degrader, and simulation was for air only.}
%     \label{fig:example_fits_data_and_sim}
% \end{figure}
% 
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/sim_vs_data_parameter_WRT_settings.png}
%     \caption{Demonstration of the variance of fitted parameters with respect to the initial fit settings. The x axis labels list the settings used for that bin e.g. `lo\_100\_hi\_20000\_bins\_50' corresponds to a lower bound of 100~ns, an upper bound of 2\mus{} and a bin width of 50~ns. Bare in mind that the $N$ values have not had any compensation for acceptance etc. applied so difference between simulation and data is expected.}
%     \label{fig:image_sim_vs_data_parameter_WRT_settings}
% \end{figure}
% 
% The largest changes to the fit are due to the fit settings figure~\ref{fig:example_fits_data_and_sim} shows examples of simulated and real data with their respective fits . These determine the range that is fitted and the smoothness of the data that the fit is attempted on. The lower bound of the range probably has the largest affect on the fit. It is obvious that a large enough lower bound will utterly remove the region in which the copper component is dominant (i.e.\ $\lesssim$ 200~ns), to avoid this the minimum value of 50~ns is usually chosen which corresponds to the maximum anti-coincidence period of the trigger. The upper bound has very little affect for any reasonable value ($>$15\mus) as that portion of the histograms is usually flat. The bin width has an important part to play as it the prime method of smoothing data. 
% 
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/example_noise.png}
%     \caption{Example of the noise seen in the data. Both the high ($\sim$16~MHz) and low ($\sim$45~kHz) frequency components are clearly visible. An enlarged view of the tail of this distribution is given in figure~\ref{fig:example_noise_zoom}}
%     \label{fig:example_noise}
% \end{figure}
% %
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/example_noise_zoom.png}
%     \caption{Enlarged view showing the high frequency component of the noise more clearly.}
%     \label{fig:example_noise_zoom}
% \end{figure}
% 
% Smoothing the data appears to be very important judging by the noise seen in figure~\ref{fig:example_noise}. As can be seen there appears to be a high frequency component with a period $\sim$60~ns (frequency $\sim$16~MHz) imposed upon a much slower carrier period $\sim$2.2\mus{} (frequency $\sim$45~kHz). Using a suitable bin width (e.g. 100~ns) the high frequency component can be removed and the overall affect of the noise greatly reduced (see figure~\ref{fig:example_smoothing}).
% 
% \begin{figure}[htbp]
%     \centering
%         \includegraphics[width=\textwidth]{images/example_smoothing.png}
%     \caption{Example of the data once suitably large bins (in this case 100~ns) have been applied in order to remove high frequency noise cf.\ figure~\ref{fig:example_noise}.}
%     \label{fig:example_smoothing}
% \end{figure}
% 
% The initial fit parameters were set by `eyeball' to approximations of their expected value, if this were not done ROOT would set all values to 0. A reasonably large range of values was chosen to avoid degeneracies (this is especially important to make sure that each fit corresponds to its label). $\tau_{c}$ is generally fixed to a range of $\pm$1~ns about its canonical value of 163.5~\cite{PhysRevC.35.2212} as this is a known value reasonably different compared to the other muonic lifetimes\footnote{The lifetimes for the other major materials in the detector are: Hydrogen 2194.903$\pm$0.066, Carbon 2026.3$\pm$1.5~ns, Nitrogen 1906.8$\pm$3.0~ns, Oxygen 1795.4$\pm$2~ns~\cite{PhysRevC.35.2212}. Where the scintillator is assumed to be mostly carbon and hydrogen and the air mainly nitrogen and oxygen.}. It is worth noting that only the negatively charged muons can form muonic atoms and so the copper component of the fit makes a reasonable approximation to this number whilst the free component will be composed of primarily of positively as well as negatively charged muons.
% 
% Once the histograms were fitted the fit parameters were extracted and used to create sub-functions corresponding to the individual components. Using ROOT's `Integral' and `IntegralError' functions the number of decays for each channel corresponding to each component could then be calculated. Equally summing over all the channels in a run the total number of muons for that run could be calculated.
% % subsection the_implementation (end)
% % section fitting_and_integration (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Muon Yield} % (fold)
% \label{sec:muon_yield}
% Once the number of muons for each run is known the muon yield is ultimately a matter of scaling. The formula used is:
% \begin{align}
%     Y = \frac{N_{mu}}{\epsilon \times A \times D \times t_{r} \times I}
% \end{align}
% Where $Y$ is the yield, $N_{mu}$ the number of muons for that run, $\epsilon$ is the detector efficiency, $A$ the acceptance for that degrader thickness, $D$ is the dead-time, $t_{r}$ is the run time in seconds and $I$ is the proton current. The detector efficiency was not measured for this experiment but based on previous experiments (e.g. detector efficiency for MuSIC~3) is set to 50\% and incorporated into both calculations for simulated and real data. 
% % chapter muon_momentum_spectrum (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % part characterising_the_beam (end)
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  